---
title: 多云环境的部署策略
tags:
---

随着容器、微服务等新技术的不断发展，运维相关的工具和技术也在不断的完善中。而JL这20年来还是使用最原始的实施方式 -- 纯人工的安装部署。由于实施运维技术的落后，导致了实施人力成本的不断攀升，以及产品没有很好的交付质量。

为了摆脱这种地下的人工劳动，最关键的是要将实施工作自动化。记得十几年前去广州GAJ做某个项目的售前演示工作时，用户提供了一台裸机，要我们快速的把系统搭建在上面能够进行演示，我们几个技术人员花了好大力气才创建了一个基本可用的环境出来，那时候WKX老板说了一句话我至今还记得，怎么不把所有的部署步骤都记录下载自动执行。虽然这只是种原始的自动化概念，和现在的CI/CD还相差很多，但是这种思想也展现出他的一些智慧了。

怎么讲实施自动化呢？说白了就是所有部署步骤都要能够通过机器运行，要让所有步骤都通过机器运行，那就需要将所有部署步骤都写在代码里头。万物皆为代码。

最传统的运维全部采用手工的方式，手工的方式测试，手工的方式代码审查，手工的方式打包，手工的方式替换文件，手工的方式创建服务器，手工的方式切换流量。而只要把这些步骤都自动化，那么整个开发到部署的环境就可以做到高度的自动化了。

我这边介绍3套方案，根据能力和时间的要求，你们可以挑选自己需要的方案。

三种部署方案

Ansible部署策略

由于目前虚拟机的管理是HW那边帮忙创建的，你们只是负责将应用部署到上面，另外你们目前是将Jenkins打出来的jar和部署文档发给现场的实施人员，由实施人员帮你们进行系统更新。

如果是用最简单的方式将手工工作自动化，就是将部署文档转化为Ansible的部署脚本，每次实施人员拿到的是jar和ansible脚本，然后实施人员需要做的是

* 将包含jar和ansible的tar文件放到Nexus或者文件服务器下。
* Jenkins job选择好版本，然后运行
* Jenkins job解压出jar和ansible，然后根据ansible组织好配置文件和jar
* 将配置文件和jar push到服务器上，并重启服务器

第一种方案只是将原来的部署文档脚本化，通过脚本化，可以减少实施人员记忆和了解部署步骤的能力和时间，但是这种方式缺少了对于底层基础设施的自动化，由于缺少了对于基础设施的自动化，就缺少了下面两种能力

* 自动化OS Patch的能力
* 扩展能力

为了获取这两种能力，我们可以采用下面两种部署策略。
基于VM的基础设施自动化和基于容器的基础设施自动化

VM的基础设施自动化 Packer/Terraform策略 vApp和RTS策略

现在的云计算分为IaaS, PaaS, SaaS，提供虚拟机管理能力的云计算是IaaS，提供这种能力的云计算一般包含有很多API供我们来将云计算资源进行编排，从而获取基础设施自动化的能力。

华为云提供了RTS的方式来编排资源，同时我们可以利用第三方的Packer/Terraform来管理云计算的基础设施，从而减少对云计算的耦合。

使用这种方式进行实施的话，相当于要提供VM Image给实施人员进行部署，然后实施人员通过Jenkins job运行RTS或者Terrform进行资源编排，在云计算平台上创建所有的VM和网络资源。这种方式下，还可以利用云计算的自动扩展组对资源进行自动扩展。

容器的基础设施自动化 - K8s部署策略



部署系统的搭建